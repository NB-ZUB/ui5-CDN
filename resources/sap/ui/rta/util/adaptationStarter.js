/*!
 * OpenUI5
 * (c) Copyright 2009-2024 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/Log","sap/ui/core/Control","sap/ui/core/Lib","sap/ui/core/UIComponent","sap/ui/fl/write/api/FeaturesAPI","sap/ui/fl/write/api/PersistenceWriteAPI","sap/ui/fl/Layer","sap/ui/fl/Utils","sap/ui/rta/util/showMessageBox","sap/ui/rta/RuntimeAuthoring"],function(e,t,r,n,o,a,i,s,u,l){"use strict";function f(e){if(i.CUSTOMER===e){return o.isKeyUser().then(function(e){if(!e){var t=r.getResourceBundleFor("sap.ui.rta");var n=new Error(t.getText("MSG_NO_KEY_USER_RIGHTS_ERROR_MESSAGE"));n.reason="isKeyUser";throw n}})}return Promise.resolve()}function T(e){var t=new URLSearchParams(window.location.search).get("fiori-tools-rta-mode");if(!t||t==="false"){var r=e.getManifest()||{};var n=r["sap.ui5"]&&r["sap.ui5"].flexEnabled;if(n===false){var o=Error("This app is not enabled for key user adaptation");o.reason="flexEnabled";throw o}}}function c(o,c,_,A,E){var p;return Promise.resolve().then(function(){if(!(o.rootControl instanceof t)&&!(o.rootControl instanceof n)){var e=Error("An invalid root control was passed");e.reason="rootControl";throw e}o.rootControl=s.getAppComponentForControl(o.rootControl)}).then(f.bind(undefined,o.flexSettings.layer)).then(function(){return T(o.rootControl)}).then(function(){p=new l(o);if(_){p.attachEvent("start",_)}if(A){p.attachEvent("failed",A)}var e=E||function(){p.destroy()};p.attachEvent("stop",e);if(c){return c(p)}}).then(function(){return p.start()}).then(function(){if(o.flexSettings.layer==="CUSTOMER"){var e={oComponent:o.rootControl,selector:o.rootControl,invalidateCache:false,includeVariants:true,includeCtrlVariants:true,currentLayer:i.CUSTOMER};a.getChangesWarning(e).then(function(e){if(e.showWarning){var t=r.getResourceBundleFor("sap.ui.rta");var n=e.warningType==="mixedChangesWarning"?{text:"MSG_ADAPTATION_STARTER_MIXED_CHANGES_WARNING",title:"TIT_ADAPTATION_STARTER_MIXED_CHANGES_TITLE"}:{text:"MSG_ADAPTATION_STARTER_NO_CHANGES_IN_P_WARNING",title:"TIT_ADAPTATION_STARTER_NO_CHANGES_IN_P_TITLE"};u(t.getText(n.text),{title:t.getText(n.title)},"warning")}})}return p}).catch(function(t){if(t!=="Reload triggered"&&!(s.getUshellContainer()&&t.reason==="flexEnabled")){var n=r.getResourceBundleFor("sap.ui.rta");u(n.getText("MSG_GENERIC_ERROR_MESSAGE",[t.message]),{title:n.getText("MSG_ADAPTATION_COULD_NOT_START")},"error");e.error("UI Adaptation could not be started",t.message)}throw t})}return c});
//# sourceMappingURL=adaptationStarter.js.map